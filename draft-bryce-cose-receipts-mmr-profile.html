<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>COSE Receipts for MMRs</title>
<meta content="Robin Bryce" name="author">
<meta content="
       This document defines a new verifiable data structure type for COSE Receipts   specifically for use with ledgers based on post-order traversal binary Merkle trees and which are designed for high throughput, ease of replication and compatibility with commodity cloud storage. 
       Post-order traversal binary Merkle trees, also known as history trees, are more commonly known as Merkle Mountain Ranges. 
    " name="description">
<meta content="xml2rfc 3.29.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-bryce-cose-receipts-mmr-profile-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.29.0
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.4
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-bryce-cose-receipts-mmr-profile.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">COSE Receipts for MMRs</td>
<td class="right">July 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Bryce</td>
<td class="center">Expires 10 January 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">TBD</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-bryce-cose-receipts-mmr-profile-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-07-09" class="published">9 July 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-01-10">10 January 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Bryce</div>
<div class="org">Datatrails</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">COSE Receipts for MMRs</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines a new verifiable data structure type for COSE Receipts <span>[<a href="#I-D.ietf-cose-merkle-tree-proofs" class="cite xref">I-D.ietf-cose-merkle-tree-proofs</a>]</span> specifically for use with ledgers based on post-order traversal binary Merkle trees and which are designed for high throughput, ease of replication and compatibility with commodity cloud storage.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">Post-order traversal binary Merkle trees, also known as history trees, are more commonly known as Merkle Mountain Ranges.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 10 January 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-description-of-the-verifiab" class="internal xref">Description of the Verifiable Data Structure</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-inclusion-proofs" class="internal xref">Inclusion Proofs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-inclusion_proof_path" class="internal xref">inclusion_proof_path</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-cose-receipt-of-inclusion" class="internal xref">COSE Receipt of Inclusion</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-verifying-the-receipt-of-in" class="internal xref">Verifying the Receipt of inclusion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-included_root" class="internal xref">included_root</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-consistency-proof" class="internal xref">Consistency Proof</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-consistency_proof_path" class="internal xref">consistency_proof_path</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-cose-receipt-of-consistency" class="internal xref">COSE Receipt of Consistency</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-verifying-the-receipt-of-co" class="internal xref">Verifying the Receipt of consistency</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="auto internal xref">7.1.1</a>.  <a href="#name-consistent_roots" class="internal xref">consistent_roots</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-appending-a-leaf" class="internal xref">Appending a leaf</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-add_leaf_hash" class="internal xref">add_leaf_hash</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-implementation-defined-stor" class="internal xref">Implementation defined storage methods</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="auto internal xref">8.2.1</a>.  <a href="#name-get" class="internal xref">Get</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="auto internal xref">8.2.2</a>.  <a href="#name-append" class="internal xref">Append</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-node-values" class="internal xref">Node values</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1">
                    <p id="section-toc.1-1.8.2.3.2.1.1"><a href="#section-8.3.1" class="auto internal xref">8.3.1</a>.  <a href="#name-hash_pospair64" class="internal xref">hash_pospair64</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-essential-supporting-algori" class="internal xref">Essential supporting algorithms</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-index_height" class="internal xref">index_height</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-peaks" class="internal xref">peaks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-detection-of-improper-inclu" class="internal xref">Detection of improper inclusion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-misbehaving-ledgers" class="internal xref">Misbehaving Ledgers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-additions-to-existing-regis" class="internal xref">Additions to Existing Registries</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-new-registries" class="internal xref">New Registries</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-assumed-bit-primitives" class="internal xref">Assumed bit primitives</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-log2floor" class="internal xref">log2floor</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-most_sig_bit" class="internal xref">most_sig_bit</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-bit_length" class="internal xref">bit_length</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a href="#appendix-B.4" class="auto internal xref">B.4</a>.  <a href="#name-all_ones" class="internal xref">all_ones</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.5">
                <p id="section-toc.1-1.14.2.5.1"><a href="#appendix-B.5" class="auto internal xref">B.5</a>.  <a href="#name-ones_count" class="internal xref">ones_count</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.6">
                <p id="section-toc.1-1.14.2.6.1"><a href="#appendix-B.6" class="auto internal xref">B.6</a>.  <a href="#name-trailing_zeros" class="internal xref">trailing_zeros</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The COSE Receipts document <span>[<a href="#I-D.ietf-cose-merkle-tree-proofs" class="cite xref">I-D.ietf-cose-merkle-tree-proofs</a>]</span> defines a common framework for defining different types of proofs, such as proof of inclusion, about verifiable data structures (VDS). For instance, inclusion proofs guarantee to a verifier that a given serializable element is recorded at a given state of the VDS, while consistency proofs are used to establish that an inclusion proof is still consistent with the new state of the VDS at a later time.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In this document, we define a new type of VDS: a post ordered binary merkle tree is, logically, the unique series of perfect binary merkle trees required to commit its leaves.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Example,<a href="#section-1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1-4">
<pre>
   6
 2   5
0 1 3 4 7
</pre><a href="#section-1-4" class="pilcrow">¶</a>
</div>
<p id="section-1-5">This illustrates <code>MMR(8)</code>, which is comprised of two perfect trees rooted at 6 and 7.
7 is the root of a tree comprised of a single element.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">The peaks of the perfect trees form the accumulator.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">The storage of a tree maintained in this way is addressed as a linear array, and additions to the tree are always appends.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">Proving and verifying are defined in terms of the cryptographic asynchronous accumulator described by <a href="https://eprint.iacr.org/2015/718.pdf">ReyzinYakoubov</a>.
The technical advantages of post-order traversal binary Merkle trees are discussed in <a href="https://static.usenix.org/event/sec09/tech/full_papers/crosby.pdf">CrosbyWallachStorage</a> and <a href="https://research.swtch.com/tlog#appendix_a">PostOrderTlog</a>.<a href="#section-1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
          <p id="section-2-2.1.1">A complete MMR(n) defines an mmr with n nodes where no equal height sibling trees exist.<a href="#section-2-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.2">
          <p id="section-2-2.2.1"><code>i</code> shall be the index of any node, including leaf nodes, in the MMR<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.3">
          <p id="section-2-2.3.1">g shall be the zero based height of a node in the tree.<a href="#section-2-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.4">
          <p id="section-2-2.4.1"><code>H(x)</code> shall be the SHA-256 digest of any value x<a href="#section-2-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.5">
          <p id="section-2-2.5.1"><code>||</code> shall mean concatenation of raw byte representations of the referenced values.<a href="#section-2-2.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-3">In this specification, all numbers are unsigned 64 bit integers.
The maximum height of a single tree is 64 (which will have <code>g=63</code> for its peak).<a href="#section-2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="description-of-the-verifiable-data-structure">
<section id="section-3">
      <h2 id="name-description-of-the-verifiab">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-description-of-the-verifiab" class="section-name selfRef">Description of the Verifiable Data Structure</a>
      </h2>
<p id="section-3-1">This documents extends the verifiable data structure registry of <span>[<a href="#I-D.ietf-cose-merkle-tree-proofs" class="cite xref">I-D.ietf-cose-merkle-tree-proofs</a>]</span> with the following value:<a href="#section-3-1" class="pilcrow">¶</a></p>
<span id="name-verifiable-data-structure-a"></span><div id="verifiable-data-structure-values">
<table class="left" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-verifiable-data-structure-a" class="selfRef">Verifiable Data Structure Algorithms</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Value</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">MMR_SHA256</td>
            <td class="text-left" rowspan="1" colspan="1">TBD_1 (requested assignment 3)</td>
            <td class="text-left" rowspan="1" colspan="1">Linearly addressed, position committing, MMR implementations, such as the MMR ledger</td>
            <td class="text-left" rowspan="1" colspan="1">This document</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="inclusion-proofs">
<section id="section-4">
      <h2 id="name-inclusion-proofs">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-inclusion-proofs" class="section-name selfRef">Inclusion Proofs</a>
      </h2>
<p id="section-4-1">The CBOR representation of an inclusion proof is<a href="#section-4-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4-2">
<pre>
inclusion-proof = bstr .cbor [

  ; zero based index of a tree node
  index: uint

  ; path proving the node's inclusion
  inclusion-path: [ + bstr ]
]
</pre><a href="#section-4-2" class="pilcrow">¶</a>
</div>
<p id="section-4-3">Note that the inclusion path for the index leads to a single permanent node in the tree.
This node will initially be a peak in the accumulator, as the tree grows it will eventually be "buried" by a new peak.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="inclusionproofpath">
<section id="section-4.1">
        <h3 id="name-inclusion_proof_path">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-inclusion_proof_path" class="section-name selfRef">inclusion_proof_path</a>
        </h3>
<p id="section-4.1-1"><code>inclusion_proof_path(i, c)</code> is used to produce the verification paths for inclusion proofs and consistency proofs.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Given:<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-3.1">
            <p id="section-4.1-3.1.1"><code>c</code> the index of the last node in any tree which contains <code>i</code>.<a href="#section-4.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-3.2">
            <p id="section-4.1-3.2.1"><code>i</code> the index of the mmr node whose verification path is required.<a href="#section-4.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-4">And the methods:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-5.1">
            <p id="section-4.1-5.1.1"><span><a href="#indexheight" class="internal xref">index_height</a> (<a href="#indexheight" class="auto internal xref">Section 9.1</a>)</span> which obtains the zero based height <code>g</code> of any node.<a href="#section-4.1-5.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-6">And the constraints:<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-7.1">
            <p id="section-4.1-7.1.1"><code>i &lt;= c</code><a href="#section-4.1-7.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-8">We define <code>inclusion_proof_path</code> as<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-4.1-9">
<pre>
  def inclusion_proof_path(i, c):

    path = []

    g = index_height(i)

    while True:

      # The sibling of i is at i +/- 2^(g+1)
      siblingoffset = (2 &lt;&lt; g)

      # If the index after i is higher, it is the left parent,
      # and i is the right sibling
      if index_height(i+1) &gt; g:

        # The witness to the right sibling is offset behind i
        isibling = i - siblingoffset + 1

        # The parent of a right sibling is stored immediately
        # after
        i += 1
      else:

        # The witness to a left sibling is offset ahead of i
        isibling = i + siblingoffset - 1

        # The parent of a left sibling is stored immediately after
        # its right sibling
        i += siblingoffset

      # When the computed sibling exceeds the range of MMR(C+1),
      # we have completed the path
      if isibling &gt; c:
          return path

      path.append(isibling)

      # Set g to the height of the next item in the path.
      g += 1
</pre><a href="#section-4.1-9" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="cose-receipt-of-inclusion">
<section id="section-5">
      <h2 id="name-cose-receipt-of-inclusion">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-cose-receipt-of-inclusion" class="section-name selfRef">COSE Receipt of Inclusion</a>
      </h2>
<p id="section-5-1">The cbor representation of an inclusion proof is:<a href="#section-5-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-5-2">
<pre>
protected-header-map = {
  &amp;(alg: 1) =&gt; int
  &amp;(vds: 395) =&gt; 3
  * cose-label =&gt; cose-value
}
</pre><a href="#section-5-2" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-5-3.1">
          <p id="section-5-3.1.1">alg (label: 1): <span class="bcp14">REQUIRED</span>. Signature algorithm identifier. Value type: int.<a href="#section-5-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.2">
          <p id="section-5-3.2.1">vds (label: 395): <span class="bcp14">REQUIRED</span>. verifiable data structure algorithm identifier. Value type: int.<a href="#section-5-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-4">The unprotected header for an inclusion proof signature is:<a href="#section-5-4" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-5-5">
<pre>
inclusion-proofs = [ + inclusion-proof ]

verifiable-proofs = {
  &amp;(inclusion-proof: -1) =&gt; inclusion-proofs
}

unprotected-header-map = {
  &amp;(vdp: 396) =&gt; verifiable-proofs
  * cose-label =&gt; cose-value
}
</pre><a href="#section-5-5" class="pilcrow">¶</a>
</div>
<p id="section-5-6">The payload of an inclusion proof signature is the tree peak committing to the nodes inclusion, or the node itself where the proof path is empty.
The algorithm <span><a href="#includedroot" class="internal xref">included_root</a> (<a href="#includedroot" class="auto internal xref">Section 5.2</a>)</span> obtains this value.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">The payload <span class="bcp14">MUST</span> be detached.
Detaching the payload forces verifiers to recompute the root from the inclusion proof,
this protects against implementation errors where the signature is verified but the payload merkle root does not match the inclusion proof.<a href="#section-5-7" class="pilcrow">¶</a></p>
<div id="verifying-the-receipt-of-inclusion">
<section id="section-5.1">
        <h3 id="name-verifying-the-receipt-of-in">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-verifying-the-receipt-of-in" class="section-name selfRef">Verifying the Receipt of inclusion</a>
        </h3>
<p id="section-5.1-1">The inclusion proof and signature are verified in order.
First the verifiers applies the inclusion proof to a possible entry (set member) bytes.
The result is the merkle root implied by the inclusion proof path for the candidate value.
The COSE Sign1 payload <span class="bcp14">MUST</span> be set to this value.
Second the verifier checks the signature of the COSE Sign1.
If the resulting signature verifies, the Receipt has proved inclusion of the entry in the verifiable data structure.
If the resulting signature does not verify, the signature may have been tampered with.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">It is recommended that implementations return a single boolean result for Receipt verification operations, to reduce the chance of accepting a valid signature over an invalid inclusion proof.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">As the proof must be processed prior to signature verification the implementation <span class="bcp14">SHOULD</span> check the lengths of the proof paths are appropriate for the provided tree sizes.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="includedroot">
<section id="section-5.2">
        <h3 id="name-included_root">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-included_root" class="section-name selfRef">included_root</a>
        </h3>
<p id="section-5.2-1">The algorithm <code>included_root</code> calculates the accumulator peak for the provided proof and node value.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Given:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">
            <p id="section-5.2-3.1.1"><code>i</code> is the index the <code>nodeHash</code> is to be shown at<a href="#section-5.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.2">
            <p id="section-5.2-3.2.1"><code>nodehash</code> the value whose inclusion is to be shown<a href="#section-5.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.3">
            <p id="section-5.2-3.3.1"><code>proof</code> is the path of sibling values committing i.<a href="#section-5.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-4">And the methods:<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-5.1">
            <p id="section-5.2-5.1.1"><span><a href="#indexheight" class="internal xref">index_height</a> (<a href="#indexheight" class="auto internal xref">Section 9.1</a>)</span> which obtains the zero based height <code>g</code> of any node.<a href="#section-5.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-5.2">
            <p id="section-5.2-5.2.1"><span><a href="#hashpospair64" class="internal xref">hash_pospair64</a> (<a href="#hashpospair64" class="auto internal xref">Section 8.3.1</a>)</span> which applies <code>H</code> to the new node position and its children.<a href="#section-5.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-6">We define <code>included_root</code> as<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-5.2-7">
<pre>
  def included_root(i, nodehash, proof):

    root = nodehash

    g = index_height(i)

    for sibling in proof:

      # If the index after i is higher, it is the left parent,
      # and i is the right sibling

      if index_height(i + 1) &gt; g:

        # The parent of a right sibling is stored immediately after

        i = i + 1

        # Set `root` to `H(i+1 || sibling || root)`
        root = hash_pospair64(i + 1, sibling, root)
      else:

        # The parent of a left sibling is stored immediately after
        # its right sibling.

        i = i + (2 &lt;&lt; g)

        # Set `root` to `H(i+1 || root || sibling)`
        root = hash_pospair64(i + 1, root, sibling)

      # Set g to the height of the next item in the path.
      g = g + 1

    # If the path length was zero, the original nodehash is returned
    return root
</pre><a href="#section-5.2-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="consistency-proof">
<section id="section-6">
      <h2 id="name-consistency-proof">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-consistency-proof" class="section-name selfRef">Consistency Proof</a>
      </h2>
<p id="section-6-1">A consistency proof shows that the accumulator, defined in <a href="https://eprint.iacr.org/2015/718.pdf">ReyzinYakoubov</a>,
for tree-size-1 is a prefix of the accumulator for tree-size-2.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The signature is over the complete accumulator for tree-size-2 obtained using the proof and the, supplied, possibly empty, list of <code>right-peaks</code> which complete the accumulator for tree-size-2.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">The receipt of consistency is defined so that a chain of cumulative consistency proofs can be verified together.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">The cbor representation of a consistency proof is:<a href="#section-6-4" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-6-5">
<pre>
consistency-path = [ * bstr ]

consistency-proof =  bstr .cbor [

  ; previous tree size
  tree-size-1: uint

  ; latest tree size
  tree-size-2: uint

  ; the inclusion path from each accumulator peak in
  ; tree-size-1 to its new peak in tree-size-2.
  consistency-paths: [ + consistency-path ]

  ; the additional peaks that
  ; complete the accumulator for tree-size-2,
  ; when appended to those produced by the consistency paths
  right-peaks: [ *bstr ]
]
</pre><a href="#section-6-5" class="pilcrow">¶</a>
</div>
<div id="consistencyproofpath">
<section id="section-6.1">
        <h3 id="name-consistency_proof_path">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-consistency_proof_path" class="section-name selfRef">consistency_proof_path</a>
        </h3>
<p id="section-6.1-1">Produces the verification paths for inclusion of the peaks of tree-size-1 under the peaks of tree-size-2.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">right-peaks are obtained by invoking <code>peaks(tree-size-2 - 1)</code>, and discarding length(proofs) from the left.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Given:<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.1">
            <p id="section-6.1-4.1.1"><code>ifrom</code> is the last index of tree-size-1<a href="#section-6.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-4.2">
            <p id="section-6.1-4.2.1"><code>ito</code> is the last index of tree-size-2<a href="#section-6.1-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-5">And the methods:<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-6.1">
            <p id="section-6.1-6.1.1"><span><a href="#inclusionproofpath" class="internal xref">inclusion_proof_path</a> (<a href="#inclusionproofpath" class="auto internal xref">Section 4.1</a>)</span><a href="#section-6.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-6.2">
            <p id="section-6.1-6.2.1"><a href="#peaks" class="auto internal xref">Section 9.2</a><a href="#section-6.1-6.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-7">And the constraints:<a href="#section-6.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-8.1">
            <p id="section-6.1-8.1.1"><code>ifrom &lt;= ito</code><a href="#section-6.1-8.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-9">We define <code>consistency_proof_paths</code> as<a href="#section-6.1-9" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-6.1-10">
<pre>
  def consistency_proof_paths(ifrom, ito):

    proof = []

    for i in peaks(ifrom):
      proof.append(inclusion_proof_path(i, ito))

    return proof
</pre><a href="#section-6.1-10" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="cose-receipt-of-consistency">
<section id="section-7">
      <h2 id="name-cose-receipt-of-consistency">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-cose-receipt-of-consistency" class="section-name selfRef">COSE Receipt of Consistency</a>
      </h2>
<p id="section-7-1">The cbor representation of an inclusion proof is:<a href="#section-7-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-7-2">
<pre>
protected-header-map = {
  &amp;(alg: 1) =&gt; int
  &amp;(vds: 395) =&gt; 3
  * cose-label =&gt; cose-value
}
</pre><a href="#section-7-2" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-7-3.1">
          <p id="section-7-3.1.1">alg (label: 1): <span class="bcp14">REQUIRED</span>. Signature algorithm identifier. Value type: int.<a href="#section-7-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.2">
          <p id="section-7-3.2.1">vds (label: 395): <span class="bcp14">REQUIRED</span>. verifiable data structure algorithm identifier. Value type: int.<a href="#section-7-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-4">The unprotected header for an inclusion proof signature is:<a href="#section-7-4" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-7-5">
<pre>
consistency-proofs = [ + consistency-proof ]

verifiable-proofs = {
  &amp;(consistency-proof: -2) =&gt; consistency-proof
}

unprotected-header-map = {
  &amp;(vdp: 396) =&gt; verifiable-proofs
  * cose-label =&gt; cose-value
}
</pre><a href="#section-7-5" class="pilcrow">¶</a>
</div>
<p id="section-7-6">The payload <span class="bcp14">MUST</span> be detached.
Detaching the payload forces verifiers to recompute the roots from the consistency proofs.
This protects against implementation errors where the signature is verified but the payload is not genuinely produced by the included proof.<a href="#section-7-6" class="pilcrow">¶</a></p>
<div id="verifying-the-receipt-of-consistency">
<section id="section-7.1">
        <h3 id="name-verifying-the-receipt-of-co">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-verifying-the-receipt-of-co" class="section-name selfRef">Verifying the Receipt of consistency</a>
        </h3>
<p id="section-7.1-1">Verification accommodates verifying the result of a cumulative series of consistency proofs.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">Perform the following for each consistency-proof in the list, verifying the signature with the output of the last.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1-3">
<li id="section-7.1-3.1">
            <p id="section-7.1-3.1.1">Initialize current proof as the first consistency-proof.<a href="#section-7.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.2">
            <p id="section-7.1-3.2.1">Initialize accumulatorfrom to the peaks of tree-size-1 in the current proof.<a href="#section-7.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.3">
            <p id="section-7.1-3.3.1">Initialize ifrom to tree-size-1 - 1 from the current proof.<a href="#section-7.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.4">
            <p id="section-7.1-3.4.1">Initialize proofs to the consistency-paths from the current proof.<a href="#section-7.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.5">
            <p id="section-7.1-3.5.1">Apply the algorithm <span><a href="#consistentroots" class="internal xref">consistent_roots</a> (<a href="#consistentroots" class="auto internal xref">Section 7.1.1</a>)</span><a href="#section-7.1-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.6">
            <p id="section-7.1-3.6.1">Apply the peaks algorithm to obtain the accumulator for tree-size-2<a href="#section-7.1-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.7">
            <p id="section-7.1-3.7.1">From the peaks for tres-size-2, discard from the left the number of roots returned by consistent_roots.<a href="#section-7.1-3.7.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.8">
            <p id="section-7.1-3.8.1">Create the consistent accumulator by appending the remaining peaks to the consistent roots.<a href="#section-7.1-3.8.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.9">
            <p id="section-7.1-3.9.1">If there are no remaining proofs, use the consistent accumulator as the detached payload and verify the signature of the COSE Sign1.<a href="#section-7.1-3.9.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-7.1-4">It is recommended that implementations return a single boolean result for Receipt verification operations, to reduce the chance of accepting a valid signature over an invalid consistency proof.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">As the proof must be processed prior to signature verification the implementation <span class="bcp14">SHOULD</span> check the lengths of the proof paths are appropriate for the provided tree sizes.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<div id="consistentroots">
<section id="section-7.1.1">
          <h4 id="name-consistent_roots">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-consistent_roots" class="section-name selfRef">consistent_roots</a>
          </h4>
<p id="section-7.1.1-1"><code>consistent_roots</code> returns the descending height ordered list of elements from the accumulator for the consistent future state.<a href="#section-7.1.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1.1-2">Implementations <span class="bcp14">MUST</span> require that the number of peaks returned by <a href="#peaks" class="auto internal xref">Section 9.2</a><code>(ifrom)</code> equals the number of entries in <code>accumulatorfrom</code>.<a href="#section-7.1.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1.1-3">Given:<a href="#section-7.1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.1-4.1">
              <p id="section-7.1.1-4.1.1"><code>ifrom</code> the last index in the complete MMR from which consistency was proven.<a href="#section-7.1.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.1.1-4.2">
              <p id="section-7.1.1-4.2.1"><code>accumulatorfrom</code> the node values corresponding to the peaks of the accumulator for tree-size-1<a href="#section-7.1.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.1.1-4.3">
              <p id="section-7.1.1-4.3.1"><code>proofs</code> the inclusion proofs for each node in <code>accumulatorfrom</code> for tree-size-2<a href="#section-7.1.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.1.1-5">And the methods:<a href="#section-7.1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.1-6.1">
              <p id="section-7.1.1-6.1.1"><span><a href="#includedroot" class="internal xref">included_root</a> (<a href="#includedroot" class="auto internal xref">Section 5.2</a>)</span><a href="#section-7.1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.1.1-6.2">
              <p id="section-7.1.1-6.2.1"><a href="#peaks" class="auto internal xref">Section 9.2</a><a href="#section-7.1.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.1.1-7">We define <code>consistent_roots</code> as<a href="#section-7.1.1-7" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.1.1-8">
<pre>
  def consistent_roots(ifrom, accumulatorfrom, proofs):

    frompeaks = peaks(ifrom)

    # if length(frompeaks) != length(proofs) -&gt; ERROR

    roots = []
    for i in range(len(accumulatorfrom)):
      root = included_root(
          frompeaks[i], accumulatorfrom[i], proofs[i])

      if roots and roots[-1] == root:
          continue
      roots.append(root)

    return roots
</pre><a href="#section-7.1.1-8" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="appending-a-leaf">
<section id="section-8">
      <h2 id="name-appending-a-leaf">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-appending-a-leaf" class="section-name selfRef">Appending a leaf</a>
      </h2>
<p id="section-8-1">An algorithm for appending to a tree maintained in post order layout is provided.
Implementation defined methods for interacting with storage are specified.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="addleafhash">
<section id="section-8.1">
        <h3 id="name-add_leaf_hash">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-add_leaf_hash" class="section-name selfRef">add_leaf_hash</a>
        </h3>
<p id="section-8.1-1">When a new node is appended, if its height matches the height of its immediate predecessor, then the two equal height siblings <span class="bcp14">MUST</span> be merged.
Merging is defined as the append of a new node which takes the adjacent peaks as its left and right children.
This process <span class="bcp14">MUST</span> proceed until there are no more completable sub trees.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2"><code>add_leaf_hash(f)</code> adds the leaf hash value f to the tree.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Given:<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-4.1">
            <p id="section-8.1-4.1.1"><code>f</code> the leaf value resulting from <code>H(x)</code> for the caller defined leaf value <code>x</code><a href="#section-8.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-4.2">
            <p id="section-8.1-4.2.1"><code>db</code> an interface supporting the <a href="#append" class="auto internal xref">Section 8.2.2</a> and <a href="#get" class="auto internal xref">Section 8.2.1</a> implementation defined storage methods.<a href="#section-8.1-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.1-5">And the methods:<a href="#section-8.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-6.1">
            <p id="section-8.1-6.1.1"><span><a href="#indexheight" class="internal xref">index_height</a> (<a href="#indexheight" class="auto internal xref">Section 9.1</a>)</span><a href="#section-8.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-6.2">
            <p id="section-8.1-6.2.1"><a href="#hashpospair64" class="auto internal xref">Section 8.3.1</a><a href="#section-8.1-6.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.1-7">We define <code>add_leaf_hash</code> as<a href="#section-8.1-7" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-8.1-8">
<pre>
  def add_leaf_hash(db, f: bytes):

    # Set g to 0, the height of the leaf item f
    g = 0

    # Set i to the result of invoking Append(f)
    i = db.append(f)

    # If index_height(i) is greater than g (#looptarget)
    while index_height(i) &gt; g:

      # Set ileft to the index of the left child of i,
      # which is i - 2^(g+1)

      ileft = i - (2 &lt;&lt; g)

      # Set iright to the index of the the right child of i,
      # which is i - 1

      iright = i - 1

      # Set v to H(i + 1 || Get(ileft) || Get(iright))
      # Set i to the result of invoking Append(v)

      i = db.append(
        hash_pospair64(i+1, db.get(ileft), db.get(iright)))

      # Set g to the height of the new i, which is g + 1
      g += 1

    return i
</pre><a href="#section-8.1-8" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="implementation-defined-storage-methods">
<section id="section-8.2">
        <h3 id="name-implementation-defined-stor">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-implementation-defined-stor" class="section-name selfRef">Implementation defined storage methods</a>
        </h3>
<p id="section-8.2-1">The following methods are assumed to be available to the implementation.
Very minimal requirements are specified.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">Informally, the storage must be array like and have no gaps.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<div id="get">
<section id="section-8.2.1">
          <h4 id="name-get">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-get" class="section-name selfRef">Get</a>
          </h4>
<p id="section-8.2.1-1">Reads the value from the tree at the supplied index.<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<p id="section-8.2.1-2">The read <span class="bcp14">MUST</span> be consistent with any other calls to Append or Get within the same algorithm invocation.<a href="#section-8.2.1-2" class="pilcrow">¶</a></p>
<p id="section-8.2.1-3">Get <span class="bcp14">MAY</span> fail for transient reasons.<a href="#section-8.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="append">
<section id="section-8.2.2">
          <h4 id="name-append">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-append" class="section-name selfRef">Append</a>
          </h4>
<p id="section-8.2.2-1">Appends new node to storage and returns the index that will be occupied by the node provided to the next call to append.<a href="#section-8.2.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2.2-2">The implementation <span class="bcp14">MUST</span> guarantee that the results of Append are immediately available to Get calls in the same invocation of the algorithm.<a href="#section-8.2.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2.2-3">Append <span class="bcp14">MUST</span> return the node <code>i</code> identifying the node location which comes next.<a href="#section-8.2.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2.2-4">The implementation <span class="bcp14">MAY</span> defer commitment to underlying persistent storage.<a href="#section-8.2.2-4" class="pilcrow">¶</a></p>
<p id="section-8.2.2-5">Append <span class="bcp14">MAY</span> fail for transient reasons.<a href="#section-8.2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="node-values">
<section id="section-8.3">
        <h3 id="name-node-values">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-node-values" class="section-name selfRef">Node values</a>
        </h3>
<p id="section-8.3-1">Interior nodes in the <span class="bcp14">MUST</span> prefix the value provided to <code>H(x)</code> with <code>pos</code>.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The value <code>v</code> for any interior node <span class="bcp14">MUST</span> be <code>H(pos || Get(LEFT_CHILD) || Get(RIGHT_CHILD))</code><a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">The algorithm for leaf addition is provided the result of <code>H(x)</code> directly.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<div id="hashpospair64">
<section id="section-8.3.1">
          <h4 id="name-hash_pospair64">
<a href="#section-8.3.1" class="section-number selfRef">8.3.1. </a><a href="#name-hash_pospair64" class="section-name selfRef">hash_pospair64</a>
          </h4>
<p id="section-8.3.1-1">Returns <code>H(pos || a || b)</code>, which is the value for the node identified by index <code>pos - 1</code><a href="#section-8.3.1-1" class="pilcrow">¶</a></p>
<p id="section-8.3.1-2">Editors note: How this draft accommodates hash alg agility is tbd.<a href="#section-8.3.1-2" class="pilcrow">¶</a></p>
<p id="section-8.3.1-3">Given:<a href="#section-8.3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3.1-4.1">
              <p id="section-8.3.1-4.1.1"><code>pos</code> the size of the MMR whose last node index is <code>pos - 1</code><a href="#section-8.3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.3.1-4.2">
              <p id="section-8.3.1-4.2.1"><code>a</code> the first value to include in the hash after <code>pos</code><a href="#section-8.3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.3.1-4.3">
              <p id="section-8.3.1-4.3.1"><code>b</code> the second value to include in the hash after <code>pos</code><a href="#section-8.3.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-8.3.1-5">And the constraints:<a href="#section-8.3.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3.1-6.1">
              <p id="section-8.3.1-6.1.1"><code>pos &lt; 2^64</code><a href="#section-8.3.1-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.3.1-6.2">
              <p id="section-8.3.1-6.2.1"><code>a</code> and <code>b</code> <span class="bcp14">MUST</span> be hashes produced by the appropriate hash alg.<a href="#section-8.3.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-8.3.1-7">We define <code>hash_pospair64</code> as<a href="#section-8.3.1-7" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-8.3.1-8">
<pre>
  def hash_pospair64(pos, a, b):

    # Note: Hash algorithm agility is tbd, this example uses SHA-256
    h = hashlib.sha256()

    # Take the big endian representation of pos
    h.update(pos.to_bytes(8, byteorder="big", signed=False))
    h.update(a)
    h.update(b)
    return h.digest()
</pre><a href="#section-8.3.1-8" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="essential-supporting-algorithms">
<section id="section-9">
      <h2 id="name-essential-supporting-algori">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-essential-supporting-algori" class="section-name selfRef">Essential supporting algorithms</a>
      </h2>
<div id="indexheight">
<section id="section-9.1">
        <h3 id="name-index_height">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-index_height" class="section-name selfRef">index_height</a>
        </h3>
<p id="section-9.1-1"><code>index_height(i)</code> returns the zero based height <code>g</code> of the node index <code>i</code><a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">Given:<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-3.1">
            <p id="section-9.1-3.1.1"><code>i</code> the index of any mmr node.<a href="#section-9.1-3.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.1-4">We define <code>index_height</code> as<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-9.1-5">
<pre>
  def index_height(i) -&gt; int:
    pos = i + 1
    while not all_ones(pos):
      pos = pos - most_sig_bit(pos) + 1

    return bit_length(pos) - 1
</pre><a href="#section-9.1-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="peaks">
<section id="section-9.2">
        <h3 id="name-peaks">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-peaks" class="section-name selfRef">peaks</a>
        </h3>
<p id="section-9.2-1"><code>peaks(i)</code> returns the peak indices for <code>MMR(i+1)</code>, which is also its accumulator.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">Assumes MMR(i+1) is complete, implementations can check for this condition by
testing the height of i+1<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2-3">Given:<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2-4.1">
            <p id="section-9.2-4.1.1"><code>i</code> the index of any mmr node.<a href="#section-9.2-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.2-5">We define <code>peaks</code><a href="#section-9.2-5" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-9.2-6">
<pre>
  def peaks(i):
    peak = 0
    peaks = []
    s = i+1
    while s != 0:
      # find the highest peak size in the current MMR(s)
      highest_size = (1 &lt;&lt; log2floor(s+1)) - 1
      peak = peak + highest_size
      peaks.append(peak-1)
      s -= highest_size

    return peaks
</pre><a href="#section-9.2-6" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-10">
      <h2 id="name-security-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-10-1">See the security considerations section of:<a href="#section-10-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-2.1">
          <p id="section-10-2.1.1"><span>[<a href="#RFC9053" class="cite xref">RFC9053</a>]</span><a href="#section-10-2.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="detection-of-improper-inclusion">
<section id="section-10.1">
        <h3 id="name-detection-of-improper-inclu">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-detection-of-improper-inclu" class="section-name selfRef">Detection of improper inclusion</a>
        </h3>
<p id="section-10.1-1">A receipt of inclusion shows only that the element is included in the ledger.
Defining whether that inclusion was legitimate, or in some way valid,  is out of scope for this document.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="misbehaving-ledgers">
<section id="section-10.2">
        <h3 id="name-misbehaving-ledgers">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-misbehaving-ledgers" class="section-name selfRef">Misbehaving Ledgers</a>
        </h3>
<p id="section-10.2-1">A ledger can misbehave in several ways. Examples include the following: failing to incorporate a leaf entry in the MMR; presenting different, conflicting views of the MMR at different times and/or to different parties.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">Detection of a failure to include items in the first place is out of scope for
this document.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
<p id="section-10.2-3">Having included an element, ledger implementations using this draft <span class="bcp14">MUST</span> use consistency proofs as the basis for proving entries are not moved, modified or excluded in future states of the MMR.
Similarly, consistency proofs <span class="bcp14">MUST</span> be the basis for proving the unequivocal history of additions.<a href="#section-10.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-11-1">Editors note: Hash agility is desired.
We can start with SHA-256.
Two of the referenced implementations use BLAKE2b-256,
We would like to add support for SHA3-256, SHA3-512, and possibly Keccak and Pedersen.<a href="#section-11-1" class="pilcrow">¶</a></p>
<div id="additions-to-existing-registries">
<section id="section-11.1">
        <h3 id="name-additions-to-existing-regis">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-additions-to-existing-regis" class="section-name selfRef">Additions to Existing Registries</a>
        </h3>
<p id="section-11.1-1">Editors note: todo registry requests<a href="#section-11.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="new-registries">
<section id="section-11.2">
        <h3 id="name-new-registries">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-new-registries" class="section-name selfRef">New Registries</a>
      </h3>
</section>
</div>
</section>
</div>
<div id="sec-normative-references">
<section id="section-12">
      <h2 id="name-normative-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="I-D.ietf-cose-merkle-tree-proofs">[I-D.ietf-cose-merkle-tree-proofs]</dt>
      <dd>
<span class="refAuthor">Steele, O.</span>, <span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Delignat-Lavaud, A.</span>, and <span class="refAuthor">C. Fournet</span>, <span class="refTitle">"COSE Receipts"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-merkle-tree-proofs-14</span>, <time datetime="2025-05-11" class="refDate">11 May 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-cose-merkle-tree-proofs-14">https://datatracker.ietf.org/doc/html/draft-ietf-cose-merkle-tree-proofs-14</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9053">[RFC9053]</dt>
    <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Initial Algorithms"</span>, <span class="seriesInfo">RFC 9053</span>, <span class="seriesInfo">DOI 10.17487/RFC9053</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9053">https://www.rfc-editor.org/rfc/rfc9053</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="references">
<section id="appendix-A">
      <h2 id="name-references">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="informative-references">
<section id="appendix-A.1">
        <h3 id="name-informative-references">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.1-1.1">
            <p id="appendix-A.1-1.1.1"><a href="https://eprint.iacr.org/2015/718.pdf">ReyzinYakoubov</a><a href="#appendix-A.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-1.2">
            <p id="appendix-A.1-1.2.1"><a href="https://static.usenix.org/event/sec09/tech/full_papers/crosby.pdf">CrosbyWallach</a><a href="#appendix-A.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-1.3">
            <p id="appendix-A.1-1.3.1"><a href="https://static.usenix.org/event/sec09/tech/full_papers/crosby.pdf">CrosbyWallachStorage</a> 3.3 Storing the log on secondary storage<a href="#appendix-A.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-1.4">
            <p id="appendix-A.1-1.4.1"><a href="https://research.swtch.com/tlog#appendix_a">PostOrderTlog</a><a href="#appendix-A.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-1.5">
            <p id="appendix-A.1-1.5.1"><a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2016-May/012715.html">PeterTodd</a><a href="#appendix-A.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-1.6">
            <p id="appendix-A.1-1.6.1"><a href="https://www-cs-faculty.stanford.edu/~knuth/taocp.html">KnuthTBT</a> 2.3.1 Traversing Binary Trees<a href="#appendix-A.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-1.7">
            <p id="appendix-A.1-1.7.1"><a href="https://eprint.iacr.org/2021/038.pdf">BNT</a><a href="#appendix-A.1-1.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="assumed-bit-primitives">
<section id="appendix-B">
      <h2 id="name-assumed-bit-primitives">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-assumed-bit-primitives" class="section-name selfRef">Assumed bit primitives</a>
      </h2>
<div id="log2floor">
<section id="appendix-B.1">
        <h3 id="name-log2floor">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-log2floor" class="section-name selfRef">log2floor</a>
        </h3>
<p id="appendix-B.1-1">Returns the floor of log base 2 x<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="appendix-B.1-2">
<pre>
  def log2floor(x):
    return x.bit_length() - 1
</pre><a href="#appendix-B.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="mostsigbit">
<section id="appendix-B.2">
        <h3 id="name-most_sig_bit">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-most_sig_bit" class="section-name selfRef">most_sig_bit</a>
        </h3>
<p id="appendix-B.2-1">Returns the mask for the the most significant bit in pos<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="appendix-B.2-2">
<pre>
  def most_sig_bit(pos) -&gt; int:
    return 1 &lt;&lt; (pos.bit_length() - 1)
</pre><a href="#appendix-B.2-2" class="pilcrow">¶</a>
</div>
<p id="appendix-B.2-3">The following primitives are assumed for working with bits as they commonly have library or hardware support.<a href="#appendix-B.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="bitlength">
<section id="appendix-B.3">
        <h3 id="name-bit_length">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-bit_length" class="section-name selfRef">bit_length</a>
        </h3>
<p id="appendix-B.3-1">The minimum number of bits to represent pos. b011 would be 2, b010 would be 2, and b001 would be 1.<a href="#appendix-B.3-1" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="appendix-B.3-2">
<pre>
  def bit_length(pos):
    return pos.bit_length()
</pre><a href="#appendix-B.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="allones">
<section id="appendix-B.4">
        <h3 id="name-all_ones">
<a href="#appendix-B.4" class="section-number selfRef">B.4. </a><a href="#name-all_ones" class="section-name selfRef">all_ones</a>
        </h3>
<p id="appendix-B.4-1">Tests if all bits, from the most significant that is set, are 1, b0111 would be true, b0101 would be false.<a href="#appendix-B.4-1" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="appendix-B.4-2">
<pre>
  def all_ones(pos) -&gt; bool:
    msb = most_sig_bit(pos)
    mask = (1 &lt;&lt; (msb + 1)) - 1
    return pos == mask
</pre><a href="#appendix-B.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="onescount">
<section id="appendix-B.5">
        <h3 id="name-ones_count">
<a href="#appendix-B.5" class="section-number selfRef">B.5. </a><a href="#name-ones_count" class="section-name selfRef">ones_count</a>
        </h3>
<p id="appendix-B.5-1">Count of set bits.
For example <code>ones_count(b101)</code> is 2<a href="#appendix-B.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="trailingzeros">
<section id="appendix-B.6">
        <h3 id="name-trailing_zeros">
<a href="#appendix-B.6" class="section-number selfRef">B.6. </a><a href="#name-trailing_zeros" class="section-name selfRef">trailing_zeros</a>
        </h3>
<div class="lang-python sourcecode" id="appendix-B.6-1">
<pre>
  (v &amp; -v).bit_length() - 1
</pre><a href="#appendix-B.6-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
    </h2>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Robin Bryce</span></div>
<div dir="auto" class="left"><span class="org">Datatrails</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:robinbryce@gmail.com" class="email">robinbryce@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
